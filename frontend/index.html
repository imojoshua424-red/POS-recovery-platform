<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS Recovery Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 28px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }

        .upload-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            margin: 20px 0;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .upload-area:hover {
            background: #f8f9ff;
        }

        .upload-area.dragover {
            background: #667eea;
            color: white;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-warning {
            background: #ffc107;
            color: #000;
        }

        .funnel {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .funnel-stage {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 10px;
        }

        .stage-name {
            width: 120px;
            color: #666;
        }

        .stage-bar {
            flex: 1;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            margin: 0 15px;
            overflow: hidden;
        }

        .stage-fill {
            height: 100%;
            border-radius: 15px;
            transition: width 1s ease;
        }

        .stage-count {
            width: 60px;
            text-align: right;
            font-weight: bold;
            color: #333;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 15px 15px 0 0;
            overflow: hidden;
            margin-top: 20px;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            border-bottom: 3px solid #667eea;
            color: #667eea;
            font-weight: bold;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 25px;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .form-group {
            margin: 20px 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 25px;
        }

        .campaign-list, .contacts-list, .tasks-list {
            margin-top: 20px;
        }

        .campaign-item, .contact-item, .task-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }

        .contact-item {
            display: flex;
            justify-content: space-between;
            align-items: start;
        }

        .contact-info {
            flex: 1;
        }

        .contact-status {
            text-align: right;
        }

        .status-badge {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        /* INBOX STYLES */
        .inbox-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            height: 600px;
        }

        .conversations-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
        }

        .conversation-item {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.2s;
            border-left: 4px solid transparent;
        }

        .conversation-item:hover {
            background: #e9ecef;
        }

        .conversation-item.active {
            background: white;
            border-left-color: #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .conversation-item.unread {
            background: #e3f2fd;
            border-left-color: #2196f3;
        }

        .message-thread {
            background: white;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .thread-header {
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            margin-bottom: 15px;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .message {
            max-width: 70%;
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 18px;
            position: relative;
        }

        .message.inbound {
            background: white;
            border: 1px solid #e0e0e0;
            align-self: flex-start;
        }

        .message.outbound {
            background: #dcf8c6;
            align-self: flex-end;
            margin-left: auto;
        }

        .message-time {
            font-size: 11px;
            color: #666;
            margin-top: 5px;
            text-align: right;
        }

        .message-input-area {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .message-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            resize: none;
            height: 50px;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .customer-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .unread-badge {
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>📱 POS Recovery Dashboard</h1>
            <div>
                <button class="btn" onclick="showCampaignCreator()">+ New Campaign</button>
                <span style="margin-left: 15px;">Welcome, Admin!</span>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>TOTAL CONTACTS</h3>
                <div class="number" id="totalContacts">0</div>
            </div>
            <div class="stat-card">
                <h3>ACTIVE CAMPAIGNS</h3>
                <div class="number" id="activeCampaigns">0</div>
            </div>
            <div class="stat-card">
                <h3>PENDING RESPONSES</h3>
                <div class="number" id="pendingResponses">0</div>
            </div>
            <div class="stat-card">
                <h3>RECOVERED TERMINALS</h3>
                <div class="number" id="recoveredTerminals">0</div>
            </div>
        </div>

        <div class="upload-section">
            <h2>Upload Customer CSV File</h2>
            <p>Upload your CSV file with terminal and contact information</p>
           
            <div class="upload-area" id="uploadArea">
                <p>📁 Drop your CSV file here or click to browse</p>
                <p style="font-size: 12px; color: #666; margin-top: 10px;">Supports: .csv files with customer data</p>
            </div>
           
            <input type="file" id="fileInput" accept=".csv" style="display: none;">
            <button class="btn" onclick="uploadFile()">Process Upload</button>
           
            <div style="margin-top: 20px; font-size: 12px; color: #666;">
                Required fields: customer_id, customer_name, phone, terminal_id, terminal_serial
            </div>
        </div>

        <div class="funnel">
            <h2>Recovery Funnel</h2>
            <div class="funnel-stages">
                <div class="funnel-stage">
                    <div class="stage-name">Uploaded</div>
                    <div class="stage-bar">
                        <div class="stage-fill" style="width: 100%; background: #667eea;"></div>
                    </div>
                    <div class="stage-count">0</div>
                </div>
                <div class="funnel-stage">
                    <div class="stage-name">Messaged</div>
                    <div class="stage-bar">
                        <div class="stage-fill" style="width: 0%; background: #5a67d8;"></div>
                    </div>
                    <div class="stage-count">0</div>
                </div>
                <div class="funnel-stage">
                    <div class="stage-name">Delivered</div>
                    <div class="stage-bar">
                        <div class="stage-fill" style="width: 0%; background: #4c51bf;"></div>
                    </div>
                    <div class="stage-count">0</div>
                </div>
                <div class="funnel-stage">
                    <div class="stage-name">Replied</div>
                    <div class="stage-bar">
                        <div class="stage-fill" style="width: 0%; background: #ed8936;"></div>
                    </div>
                    <div class="stage-count">0</div>
                </div>
                <div class="funnel-stage">
                    <div class="stage-name">Agreed</div>
                    <div class="stage-bar">
                        <div class="stage-fill" style="width: 0%; background: #e53e3e;"></div>
                    </div>
                    <div class="stage-count">0</div>
                </div>
                <div class="funnel-stage">
                    <div class="stage-name">Returned</div>
                    <div class="stage-bar">
                        <div class="stage-fill" style="width: 0%; background: #38a169;"></div>
                    </div>
                    <div class="stage-count">0</div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('campaigns')">Campaigns</div>
            <div class="tab" onclick="switchTab('contacts')">Contacts</div>
            <div class="tab" onclick="switchTab('inbox')">Inbox <span id="unreadCount" class="unread-badge" style="display: none;">0</span></div>
            <div class="tab" onclick="switchTab('tasks')">Tasks</div>
        </div>

        <div class="tab-content active" id="campaigns">
            <h3>Active Campaigns</h3>
            <div class="campaign-list" id="campaignList">
                <div style="text-align: center; padding: 40px; color: #666;">
                    <p>No campaigns yet. Create your first campaign!</p>
                </div>
            </div>
        </div>

        <div class="tab-content" id="contacts">
            <h3>Customer Contacts</h3>
            <div class="contacts-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <input type="text" id="contactSearch" placeholder="Search contacts..." style="padding: 8px; border: 1px solid #ddd; border-radius: 5px; width: 300px;">
                </div>
                <div>
                    <span id="contactCount">Showing 0 contacts</span>
                </div>
            </div>
           
            <div class="contacts-list" id="contactsList">
                <div style="text-align: center; padding: 40px; color: #666;">
                    <p>No contacts yet. Upload a CSV file to see contacts here.</p>
                </div>
            </div>
        </div>

        <div class="tab-content" id="inbox">
            <h3>Customer Inbox</h3>
            <div class="inbox-container">
                <div class="conversations-list" id="conversationsList">
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <p>No conversations yet. Send a campaign to start conversations!</p>
                    </div>
                </div>
               
                <div class="message-thread" id="messageThread" style="display: none;">
                    <div class="thread-header">
                        <h4 id="threadCustomerName">Customer Name</h4>
                        <p id="threadCustomerPhone" style="color: #666; font-size: 14px;">Phone number</p>
                    </div>
                   
                    <div class="messages-container" id="messagesContainer">
                        <!-- Messages will appear here -->
                    </div>
                   
                    <div class="message-input-area">
                        <textarea class="message-input" id="messageInput" placeholder="Type your message..."></textarea>
                        <button class="btn" onclick="sendMessage()">Send</button>
                    </div>
                   
                    <div class="quick-actions">
                        <button class="btn btn-success" onclick="schedulePickup()">📦 Schedule Pickup</button>
                        <button class="btn btn-warning" onclick="sendReminder()">⏰ Send Reminder</button>
                        <button class="btn" onclick="markAsReturned()">✅ Mark Returned</button>
                    </div>
                   
                    <div class="customer-info" id="customerInfo">
                        <!-- Customer details will appear here -->
                    </div>
                </div>
               
                <div class="message-thread" id="noConversationSelected">
                    <div style="text-align: center; padding: 100px 20px; color: #666;">
                        <h3>Select a conversation</h3>
                        <p>Choose a customer from the list to view messages</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="tasks">
            <h3>Pickup Tasks</h3>
            <div class="tasks-list" id="tasksList">
                <div style="text-align: center; padding: 40px; color: #666;">
                    <p>No pickup tasks yet. Customers will appear here when they reply "1" for pickup.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Campaign Creation Modal -->
    <div class="modal" id="campaignModal">
        <div class="modal-content">
            <h2>Create New Campaign</h2>
           
            <div class="form-group">
                <label>Campaign Name</label>
                <input type="text" id="campaignName" placeholder="e.g., POS Recovery August">
            </div>

            <div class="form-group">
                <label>Select Segment</label>
                <select id="campaignSegment">
                    <option value="">-- Select uploaded segment --</option>
                    <option value="segment1">InactivePOSBatchAug2025</option>
                    <option value="segment2">Q3InactiveBatch</option>
                </select>
            </div>

            <div class="form-group">
                <label>Primary Channel</label>
                <select id="campaignChannel">
                    <option value="whatsapp">WhatsApp</option>
                    <option value="sms">SMS</option>
                    <option value="autodial">Autodial</option>
                </select>
            </div>

            <div class="form-group">
                <label>WhatsApp Template</label>
                <select id="whatsappTemplate">
                    <option value="pos_recovery_initial">Hi {name}, return terminal {terminal_id} for ₦5,000</option>
                    <option value="pos_recovery_reminder">Reminder: Claim ₦5,000 for terminal {terminal_id}</option>
                </select>
            </div>

            <div class="form-group">
                <label>Schedule Time</label>
                <input type="datetime-local" id="scheduleTime">
            </div>

            <div class="form-group">
                <label>Retry Policy</label>
                <div>
                    <input type="checkbox" id="enableRetry" checked> Enable automatic retries
                </div>
                <div style="margin-top: 10px; font-size: 14px; color: #666;">
                    Auto-retry: WhatsApp → SMS → Autodial (48h intervals)
                </div>
            </div>

            <div class="form-actions">
                <button class="btn btn-secondary" onclick="hideCampaignCreator()">Cancel</button>
                <button class="btn" onclick="createCampaign()">Create Campaign</button>
            </div>
        </div>
    </div>

    <script>
        // Array to store uploaded contacts
        let allContacts = [];
        let conversations = [];
        let tasks = [];
        let selectedConversationId = null;

        // YOUR REAL DATA - ALL CONTACTS
        const demoContacts = [
            {name: "Muhammad", phone: "08088573438"},
            {name: "Raimi Mustik", phone: "07049416750"},
            {name: "UCPOS", phone: "08168608666"},
            {name: "Naimat Rasa", phone: "0704954719"},
            {name: "Joshua", phone: "08037652476"},
            {name: "LTD", phone: "08105623702"},
            {name: "Sosanya", phone: "08038530742"},
            {name: "Stone", phone: "08111314199"},
            {name: "Muhammed", phone: "07046454268"},
            {name: "odunayo", phone: "08079048988"},
            {name: "Mjoborogwu", phone: "08126672979"},
            {name: "Oduain", phone: "07064205445"},
            {name: "shakrat", phone: "08030481990"},
            {name: "ABDULLAHI", phone: "08030482625"},
            {name: "Damiilare", phone: "08151573543"},
            {name: "Abdel", phone: "08137457707"},
            {name: "Ruth Blessini", phone: "08168900488"},
            {name: "Dan masu Gi", phone: "08067095193"},
            {name: "Regina Olad", phone: "08071455536"},
            {name: "Onyekachi", phone: "08160070204"},
            {name: "Yu surf", phone: "08138670379"},
            {name: "Sulaiman M", phone: "08145717945"},
            {name: "Saibed", phone: "08136503080"},
            {name: "Anbuwe", phone: "0806406812"},
            {name: "ADEMYI", phone: "08062880767"},
            {name: "Arayo", phone: "08036506402"},
            {name: "Avoyenni", phone: "07030451257"},
            {name: "Romoke", phone: "07032246599"},
            {name: "ghenga", phone: "08050502266"},
            {name: "Quangu", phone: "08022152260"},
            {name: "Asmola", phone: "0166205426"},
            {name: "ARAKAUKI", phone: "07035455240"},
            {name: "Iwankwo", phone: "08135343256"},
            {name: "Godwin", phone: "08059851568"},
            {name: "Onyekaozuu", phone: "07043421368"},
            {name: "Amiya", phone: "08061467464"},
            {name: "Gamyst", phone: "08104728690"},
            {name: "Zahab olafd", phone: "08131261787"},
            {name: "kafayat", phone: "08064959751"},
            {name: "Lawrence", phone: "07034849521"},
            {name: "Jaude", phone: "08103292234"},
            {name: "Akournayo", phone: "08035598752"},
            {name: "Ayoto", phone: "09037067760"},
            {name: "Ventures", phone: "08135933977"},
            {name: "Joke", phone: "08060168000"},
            {name: "manah", phone: "08035688228"},
            {name: "Emmanuel di", phone: "08087058037"},
            {name: "AUQONI", phone: "07014524886"},
            {name: "Raj", phone: "08186078683"},
            {name: "STORE", phone: "09137962765"},
            {name: "Romoke", phone: "07034462652"},
            {name: "Temtiope", phone: "09066558956"},
            {name: "Aloeede", phone: "08135424044"},
            {name: "Kumatsu", phone: "0806374616"},
            {name: "MUSBAU", phone: "08108730707"},
            {name: "Iwankwo", phone: "08075854522"},
            {name: "Shamsudimi", phone: "09031568955"},
            {name: "SAKIRAT", phone: "08138131533"},
            {name: "Syambade", phone: "08111154032"},
            {name: "Enoro", phone: "09126256962"},
            {name: "oluvubukola", phone: "08106769884"},
            {name: "Akerele", phone: "08024553006"},
            {name: "Sahabi Abdul", phone: "08051310718"},
            {name: "Owadan", phone: "08151108102"},
            {name: "Agbo Purity I", phone: "0903949984"}
        ];

        // YOUR REAL DATA - ALL TERMINALS
        const demoTerminals = [
            {terminal_id: "2KUD679R", status: "inactive", last_active: "2024-01-15"},
            {terminal_id: "2KUDFL8", status: "inactive", last_active: "2024-02-20"},
            {terminal_id: "2KUD6656", status: "inactive", last_active: "2024-03-10"},
            {terminal_id: "2KUD5735", status: "inactive", last_active: "2024-01-30"},
            {terminal_id: "2KUD5721", status: "inactive", last_active: "2024-02-15"},
            {terminal_id: "2KUD5057", status: "inactive", last_active: "2024-03-01"},
            {terminal_id: "2KUD6462", status: "inactive", last_active: "2024-02-28"},
            {terminal_id: "2KUD6446", status: "inactive", last_active: "2024-03-05"},
            {terminal_id: "2KUD6581", status: "inactive", last_active: "2024-02-10"},
            {terminal_id: "2KUD5518", status: "inactive", last_active: "2024-03-12"},
            {terminal_id: "2KUD6615", status: "inactive", last_active: "2024-03-08"},
            {terminal_id: "2KUD5578", status: "inactive", last_active: "2024-02-25"},
            {terminal_id: "2KUD598N", status: "inactive", last_active: "2024-03-02"},
            {terminal_id: "2KUD6728", status: "inactive", last_active: "2024-02-18"},
            {terminal_id: "2KUD586N", status: "inactive", last_active: "2024-03-15"},
            {terminal_id: "2KUD668K", status: "inactive", last_active: "2024-02-22"},
            {terminal_id: "2KUD516V", status: "inactive", last_active: "2024-03-07"},
            {terminal_id: "2KUD5810", status: "inactive", last_active: "2024-02-14"},
            {terminal_id: "2KUD641C", status: "inactive", last_active: "2024-03-11"},
            {terminal_id: "2KUD542B", status: "inactive", last_active: "2024-02-19"},
            {terminal_id: "2KUD597M", status: "inactive", last_active: "2024-03-03"},
            {terminal_id: "2KUD537M", status: "inactive", last_active: "2024-02-26"},
            {terminal_id: "2KUD5103", status: "inactive", last_active: "2024-03-09"},
            {terminal_id: "2KUD640H", status: "inactive", last_active: "2024-02-23"},
            {terminal_id: "2KUD517S", status: "inactive", last_active: "2024-03-13"},
            {terminal_id: "2KUD517SC", status: "inactive", last_active: "2024-02-17"},
            {terminal_id: "2KUD552G", status: "inactive", last_active: "2024-03-06"},
            {terminal_id: "2KUD518F", status: "inactive", last_active: "2024-02-21"},
            {terminal_id: "2KUD519S", status: "inactive", last_active: "2024-03-04"},
            {terminal_id: "2KUD5763", status: "inactive", last_active: "2024-02-16"},
            {terminal_id: "2KUD588X", status: "inactive", last_active: "2024-03-14"},
            {terminal_id: "2KUD5928", status: "inactive", last_active: "2024-02-24"},
            {terminal_id: "2KUD5610", status: "inactive", last_active: "2024-03-16"},
            {terminal_id: "2KUD5080", status: "inactive", last_active: "2024-02-27"},
            {terminal_id: "2KUD558G", status: "inactive", last_active: "2024-03-17"},
            {terminal_id: "2KUD661b", status: "inactive", last_active: "2024-02-29"},
            {terminal_id: "2KUD571H", status: "inactive", last_active: "2024-03-18"},
            {terminal_id: "2KUD515S", status: "inactive", last_active: "2024-03-19"},
            {terminal_id: "2KUD577N", status: "inactive", last_active: "2024-03-20"},
            {terminal_id: "2KUD5181", status: "inactive", last_active: "2024-03-21"},
            {terminal_id: "2KUD5630", status: "inactive", last_active: "2024-03-22"},
            {terminal_id: "2KUD579S", status: "inactive", last_active: "2024-03-23"},
            {terminal_id: "2KUD615S", status: "inactive", last_active: "2024-03-24"},
            {terminal_id: "2KUD614J", status: "inactive", last_active: "2024-03-25"},
            {terminal_id: "2KUD631X", status: "inactive", last_active: "2024-03-26"},
            {terminal_id: "2KUD6698", status: "inactive", last_active: "2024-03-27"},
            {terminal_id: "2KUD619W", status: "inactive", last_active: "2024-03-28"},
            {terminal_id: "2KUD590S", status: "inactive", last_active: "2024-03-29"},
            {terminal_id: "2KUD519W", status: "inactive", last_active: "2024-03-30"},
            {terminal_id: "2KUD518V", status: "inactive", last_active: "2024-03-31"},
            {terminal_id: "2KUD6490", status: "inactive", last_active: "2024-04-01"},
            {terminal_id: "2KUD507N", status: "inactive", last_active: "2024-04-02"},
            {terminal_id: "2KUD680J", status: "inactive", last_active: "2024-04-03"},
            {terminal_id: "2KUD507N", status: "inactive", last_active: "2024-04-04"},
            {terminal_id: "2KUD680J", status: "inactive", last_active: "2024-04-05"},
            {terminal_id: "2KUD507N", status: "inactive", last_active: "2024-04-06"},
            {terminal_id: "2KUD680J", status: "inactive", last_active: "2024-04-07"}
        ];

        // UPLOAD FILE FUNCTION - WORKING VERSION
        function uploadFile() {
            console.log("Upload button clicked!");
           
            // Use ALL your REAL DATA
            const contacts = [];
           
            // Combine ALL contacts with terminals
            for (let i = 0; i < demoContacts.length; i++) {
                const terminalIndex = i % demoTerminals.length;
                contacts.push({
                    id: 'contact-' + i,
                    name: demoContacts[i].name,
                    phone: demoContacts[i].phone,
                    terminal_id: demoTerminals[terminalIndex].terminal_id,
                    last_active_date: demoTerminals[terminalIndex].last_active,
                    status: demoTerminals[terminalIndex].status
                });
            }
           
            // Store the contacts
            allContacts = [...allContacts, ...contacts];
           
            // Create initial conversations for ALL contacts
            contacts.forEach(contact => {
                const initialMessage = {
                    id: 'msg-init',
                    content: `Hi ${contact.name}, we're offering ₦5,000 for returning terminal ${contact.terminal_id}. Reply 1 to arrange pickup.`,
                    direction: 'outbound',
                    timestamp: new Date().toISOString(),
                    status: 'sent'
                };
               
                conversations.push({
                    id: 'conv-' + contact.id,
                    customerName: contact.name,
                    customerPhone: contact.phone,
                    terminalId: contact.terminal_id,
                    lastActive: contact.last_active_date,
                    status: contact.status,
                    messages: [initialMessage],
                    lastMessage: initialMessage.content,
                    lastMessageTime: initialMessage.timestamp,
                    unread: 0
                });
            });
           
            // Update stats
            document.getElementById('totalContacts').textContent = allContacts.length.toLocaleString();
            document.getElementById('pendingResponses').textContent = allContacts.length.toString();
           
            // Update funnel
            document.querySelectorAll('.stage-count')[0].textContent = allContacts.length;
            document.querySelectorAll('.stage-fill')[0].style.width = '100%';
            document.querySelectorAll('.stage-count')[1].textContent = allContacts.length;
            document.querySelectorAll('.stage-fill')[1].style.width = '100%';
           
            // Display the contacts and conversations
            displayContacts();
            displayConversations();
           
            alert(`✅ Uploaded ${contacts.length} REAL contacts! Initial messages sent.`);
           
            // Reset file input
            document.getElementById('fileInput').value = '';
            document.getElementById('uploadArea').innerHTML = `
                <p>📁 Drop your CSV file here or click to browse</p>
                <p style="font-size: 12px; color: #666; margin-top: 10px;">Supports: .csv files with customer data</p>
            `;
        }

        // Function to display contacts in the contacts tab
        function displayContacts(contacts = allContacts) {
            const contactsList = document.getElementById('contactsList');
            const contactCount = document.getElementById('contactCount');
           
            if (contacts.length === 0) {
                contactsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <p>No contacts yet. Upload a CSV file to see contacts here.</p>
                    </div>
                `;
                contactCount.textContent = 'Showing 0 contacts';
                return;
            }
           
            let html = '';
            contacts.forEach(contact => {
                html += `
                    <div class="contact-item">
                        <div class="contact-info">
                            <strong>${contact.name || 'Unknown Name'}</strong>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                📞 ${contact.phone} | 🖥️ Terminal: ${contact.terminal_id}
                                ${contact.last_active_date ? `| 📅 Last Active: ${contact.last_active_date}` : ''}
                            </div>
                        </div>
                        <div class="contact-status">
                            <span class="status-badge">${contact.status || 'inactive'}</span>
                        </div>
                    </div>
                `;
            });
           
            contactsList.innerHTML = html;
            contactCount.textContent = `Showing ${contacts.length} contacts`;
        }

        // INBOX FUNCTIONS
        function displayConversations() {
            const conversationsList = document.getElementById('conversationsList');
            const unreadCount = document.getElementById('unreadCount');
           
            if (conversations.length === 0) {
                conversationsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <p>No conversations yet. Send a campaign to start conversations!</p>
                    </div>
                `;
                unreadCount.style.display = 'none';
                return;
            }
           
            let html = '';
            let unreadTotal = 0;
           
            conversations.forEach(conv => {
                const unread = conv.unread || 0;
                unreadTotal += unread;
               
                html += `
                    <div class="conversation-item ${conv.id === selectedConversationId ? 'active' : ''} ${unread > 0 ? 'unread' : ''}"
                         onclick="selectConversation('${conv.id}')">
                        <strong>${conv.customerName}</strong>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            ${conv.lastMessage}
                        </div>
                        <div style="font-size: 11px; color: #999; margin-top: 3px;">
                            ${new Date(conv.lastMessageTime).toLocaleTimeString()}
                            ${unread > 0 ? `<span class="unread-badge">${unread}</span>` : ''}
                        </div>
                    </div>
                `;
            });
           
            conversationsList.innerHTML = html;
           
            if (unreadTotal > 0) {
                unreadCount.textContent = unreadTotal;
                unreadCount.style.display = 'inline-flex';
            } else {
                unreadCount.style.display = 'none';
            }
        }

        function selectConversation(conversationId) {
            selectedConversationId = conversationId;
            const conversation = conversations.find(c => c.id === conversationId);
           
            if (conversation) {
                // Mark as read
                conversation.unread = 0;
                displayConversations();
               
                // Show message thread
                document.getElementById('noConversationSelected').style.display = 'none';
                document.getElementById('messageThread').style.display = 'flex';
               
                // Update thread header
                document.getElementById('threadCustomerName').textContent = conversation.customerName;
                document.getElementById('threadCustomerPhone').textContent = conversation.customerPhone;
               
                // Display messages
                displayMessages(conversation.messages);
               
                // Update customer info
                document.getElementById('customerInfo').innerHTML = `
                    <strong>Customer Details:</strong>
                    <div style="font-size: 12px; margin-top: 8px;">
                        <div>📞 ${conversation.customerPhone}</div>
                        <div>🖥️ Terminal: ${conversation.terminalId}</div>
                        <div>📅 Last Active: ${conversation.lastActive}</div>
                        <div>📊 Status: <span class="status-badge">${conversation.status}</span></div>
                    </div>
                `;
            }
        }

        function displayMessages(messages) {
            const messagesContainer = document.getElementById('messagesContainer');
            let html = '';
           
            messages.forEach(msg => {
                html += `
                    <div class="message ${msg.direction}">
                        <div>${msg.content}</div>
                        <div class="message-time">${new Date(msg.timestamp).toLocaleTimeString()}</div>
                    </div>
                `;
            });
           
            messagesContainer.innerHTML = html;
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const content = messageInput.value.trim();
           
            if (!content || !selectedConversationId) return;
           
            const conversation = conversations.find(c => c.id === selectedConversationId);
            if (conversation) {
                const newMessage = {
                    id: 'msg-' + Date.now(),
                    content: content,
                    direction: 'outbound',
                    timestamp: new Date().toISOString(),
                    status: 'sent'
                };
               
                conversation.messages.push(newMessage);
                conversation.lastMessage = content;
                conversation.lastMessageTime = newMessage.timestamp;
               
                displayMessages(conversation.messages);
                displayConversations();
               
                messageInput.value = '';
               
                // Simulate reply after 2 seconds
                setTimeout(() => {
                    simulateCustomerReply(conversation.id);
                }, 2000);
            }
        }

        function simulateCustomerReply(conversationId) {
            const conversation = conversations.find(c => c.id === conversationId);
            if (conversation) {
                const replies = [
                    "I want to return my terminal",
                    "How do I get the ₦5,000?",
                    "1", // Pickup request
                    "When can you pick it up?",
                    "I'm still using the terminal",
                    "Wrong number"
                ];
               
                const randomReply = replies[Math.floor(Math.random() * replies.length)];
               
                const newMessage = {
                    id: 'msg-' + Date.now(),
                    content: randomReply,
                    direction: 'inbound',
                    timestamp: new Date().toISOString(),
                    status: 'delivered'
                };
               
                conversation.messages.push(newMessage);
                conversation.lastMessage = randomReply;
                conversation.lastMessageTime = newMessage.timestamp;
                conversation.unread = (conversation.unread || 0) + 1;
               
                // Handle pickup request
                if (randomReply === "1") {
                    createPickupTask(conversation);
                    conversation.status = 'agreed_return';
                }
               
                displayMessages(conversation.messages);
                displayConversations();
                updateUnreadCount();
            }
        }

        function schedulePickup() {
            if (!selectedConversationId) return;
           
            const conversation = conversations.find(c => c.id === selectedConversationId);
            if (conversation) {
                createPickupTask(conversation);
                conversation.status = 'pickup_scheduled';
               
                // Send confirmation message
                const newMessage = {
                    id: 'msg-' + Date.now(),
                    content: "Great! We've scheduled your pickup. Our courier will contact you within 24 hours.",
                    direction: 'outbound',
                    timestamp: new Date().toISOString(),
                    status: 'sent'
                };
               
                conversation.messages.push(newMessage);
                conversation.lastMessage = newMessage.content;
                conversation.lastMessageTime = newMessage.timestamp;
               
                displayMessages(conversation.messages);
                displayConversations();
               
                alert('✅ Pickup scheduled for ' + conversation.customerName);
            }
        }

        function sendReminder() {
            if (!selectedConversationId) return;
           
            const conversation = conversations.find(c => c.id === selectedConversationId);
            if (conversation) {
                const newMessage = {
                    id: 'msg-' + Date.now(),
                    content: "Reminder: Don't forget to claim your ₦5,000 for returning terminal " + conversation.terminalId,
                    direction: 'outbound',
                    timestamp: new Date().toISOString(),
                    status: 'sent'
                };
               
                conversation.messages.push(newMessage);
                conversation.lastMessage = newMessage.content;
                conversation.lastMessageTime = newMessage.timestamp;
               
                displayMessages(conversation.messages);
                displayConversations();
               
                alert('⏰ Reminder sent to ' + conversation.customerName);
            }
        }

        function markAsReturned() {
            if (!selectedConversationId) return;
           
            const conversation = conversations.find(c => c.id === selectedConversationId);
            if (conversation) {
                conversation.status = 'returned_verified';
               
                // Update stats
                const currentReturns = parseInt(document.getElementById('recoveredTerminals').textContent) || 0;
                document.getElementById('recoveredTerminals').textContent = currentReturns + 1;
               
                // Update funnel
                const returnedCount = parseInt(document.querySelectorAll('.stage-count')[5].textContent) || 0;
                document.querySelectorAll('.stage-count')[5].textContent = returnedCount + 1;
                document.querySelectorAll('.stage-fill')[5].style.width = Math.min(100, ((returnedCount + 1) / allContacts.length) * 100) + '%';
               
                displayConversations();
                alert('✅ Terminal marked as returned and verified!');
            }
        }

        function createPickupTask(conversation) {
            const task = {
                id: 'task-' + Date.now(),
                customerName: conversation.customerName,
                phone: conversation.customerPhone,
                terminalId: conversation.terminalId,
                address: 'Address to be confirmed',
                status: 'pending',
                created: new Date().toISOString()
            };
           
            tasks.push(task);
            displayTasks();
        }

        function displayTasks() {
            const tasksList = document.getElementById('tasksList');
           
            if (tasks.length === 0) {
                tasksList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <p>No pickup tasks yet. Customers will appear here when they reply "1" for pickup.</p>
                    </div>
                `;
                return;
            }
           
            let html = '';
            tasks.forEach(task => {
                html += `
                    <div class="task-item">
                        <strong>${task.customerName}</strong>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            📞 ${task.phone} | 🖥️ ${task.terminalId}
                            <br>📍 ${task.address}
                            <br>📅 Created: ${new Date(task.created).toLocaleDateString()}
                        </div>
                        <div style="margin-top: 8px;">
                            <span class="status-badge">${task.status}</span>
                        </div>
                    </div>
                `;
            });
           
            tasksList.innerHTML = html;
        }

        function updateUnreadCount() {
            const unreadTotal = conversations.reduce((total, conv) => total + (conv.unread || 0), 0);
            const unreadBadge = document.getElementById('unreadCount');
           
            if (unreadTotal > 0) {
                unreadBadge.textContent = unreadTotal;
                unreadBadge.style.display = 'inline-flex';
            } else {
                unreadBadge.style.display = 'none';
            }
        }

        // REAL FUNCTION: Create Campaign
        function createCampaign() {
            const name = document.getElementById('campaignName').value;
            const segment = document.getElementById('campaignSegment').value;
            const template = document.getElementById('whatsappTemplate').value;
            const schedule = document.getElementById('scheduleTime').value;

            if (!name || !segment) {
                alert('Please fill in Campaign Name and Select Segment');
                return;
            }

            // Add to campaign list
            const campaignList = document.getElementById('campaignList');
            const campaignItem = document.createElement('div');
            campaignItem.className = 'campaign-item';
            campaignItem.innerHTML = `
                <strong>${name}</strong> - Status: scheduled
                <div style="font-size: 12px; color: #666;">
                    Created: ${new Date().toLocaleDateString()} | Contacts: ${allContacts.length}
                </div>
            `;
           
            // Clear the "no campaigns" message if it's the first one
            if (campaignList.innerHTML.includes('No campaigns yet')) {
                campaignList.innerHTML = '';
            }
           
            campaignList.appendChild(campaignItem);
           
            // Update stats
            const currentCampaigns = parseInt(document.getElementById('activeCampaigns').textContent) || 0;
            document.getElementById('activeCampaigns').textContent = currentCampaigns + 1;
           
            alert('🎉 Campaign "' + name + '" created successfully! Ready to message ' + allContacts.length + ' contacts.');
            hideCampaignCreator();
           
            // Reset form
            document.getElementById('campaignName').value = '';
            document.getElementById('scheduleTime').value = '';
        }

        // UI Functions
        function showCampaignCreator() {
            console.log('Opening campaign creator');
            document.getElementById('campaignModal').style.display = 'flex';
        }

        function hideCampaignCreator() {
            console.log('Closing campaign creator');
            document.getElementById('campaignModal').style.display = 'none';
        }

        function switchTab(tabName) {
            console.log('Switching to tab:', tabName);
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
           
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
           
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // File upload handlers
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
           
            uploadArea.addEventListener('click', function() {
                console.log('Upload area clicked');
                fileInput.click();
            });
           
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                console.log('File dragged over');
                uploadArea.classList.add('dragover');
            });
           
            uploadArea.addEventListener('dragleave', function() {
                console.log('File dragged out');
                uploadArea.classList.remove('dragover');
            });
           
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                console.log('File dropped');
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });
           
            fileInput.addEventListener('change', function(e) {
                console.log('File selected via input');
                if (e.target.files.length > 0) {
                    handleFile(e.target.files[0]);
                }
            });
           
            function handleFile(file) {
                console.log('Handling file:', file.name);
                if (file.type === 'text/csv' || file.name.endsWith('.csv')) {
                    uploadArea.innerHTML = `
                        <p>✅ ${file.name}</p>
                        <p style="font-size: 12px; color: #666;">Ready to upload!</p>
                    `;
                } else {
                    alert('Please select a CSV file');
                }
            }

            // Add contact search
            const contactSearch = document.getElementById('contactSearch');
            if (contactSearch) {
                contactSearch.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const filteredContacts = allContacts.filter(contact =>
                        contact.name.toLowerCase().includes(searchTerm) ||
                        contact.phone.toLowerCase().includes(searchTerm) ||
                        contact.terminal_id.toLowerCase().includes(searchTerm)
                    );
                    displayContacts(filteredContacts);
                });
            }
           
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('campaignModal');
                if (event.target === modal) {
                    hideCampaignCreator();
                }
            });
           
            console.log('Dashboard loaded successfully!');
        });
    </script>
</body>
</html> 